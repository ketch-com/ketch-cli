{
  "$schema": "http://json-schema.org/draft-07/schema",
  "type": "object",
  "title": "Workflow",
  "required": [
    "kind",
    "code",
    "name",
    "steps"
  ],
  "additionalProperties": false,
  "properties": {
    "kind": {
      "type": "string",
      "title": "Kind of custom object",
      "pattern": "workflow"
    },
    "code": {
      "type": "string",
      "title": "code of the workflow"
    },
    "name": {
      "type": "string",
      "title": "name of the workflow"
    },
    "readonly": {
      "type": "boolean",
      "title": "set true to make the workflow not editable",
      "default": "false"
    },
    "options": {
      "type": "object",
      "title": "options for starting the workflow",
      "properties": {
        "taskQueue": {
          "type": "string"
        },
        "workflowExecutionTimeout": {
          "type": "integer",
          "format": "int64"
        },
        "workflowRunTimeout": {
          "type": "integer",
          "format": "int64"
        },
        "workflowTaskTimeout": {
          "type": "integer",
          "format": "int64"
        },
        "memo": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          }
        },
        "searchAttributes": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          }
        },
        "retryPolicy": {
          "type": "object",
          "properties": {
            "initialInterval": {
              "type": "integer",
              "format": "int64"
            },
            "backoffCoefficient": {
              "type": "integer",
              "format": "double"
            },
            "maximumInterval": {
              "type": "integer",
              "format": "int64"
            },
            "maximumAttempts": {
              "type": "integer",
              "format": "int64"
            },
            "nonRetryableErrorReasons": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          }
        }
      }
    },
    "steps": {
      "type": "array",
      "items": {
        "type": "object",
        "title": "step represents a step in a workflow.",
        "properties": {
          "activity": {
            "type": "object",
            "properties": {
              "id": {
                "type": "string"
              },
              "code": {
                "type": "string"
              },
              "description": {
                "type": "string"
              },
              "step": {
                "type": "string"
              },
              "fn": {
                "type": "string"
              },
              "next": {
                "type": "string"
              },
              "options": {
                "type": "object",
                "properties": {
                  "taskQueue": {
                    "type": "string"
                  },
                  "scheduleToCloseTimeout": {
                    "type": "integer",
                    "format": "int64"
                  },
                  "scheduleToStartTimeout": {
                    "type": "integer",
                    "format": "int64"
                  },
                  "startToCloseTimeout": {
                    "type": "integer",
                    "format": "int64"
                  },
                  "heartbeatTimeout": {
                    "type": "integer",
                    "format": "int64"
                  },
                  "waitForCancellation": {
                    "type": "boolean"
                  },
                  "retryPolicy": {
                    "type": "string",
                    "enum": [
                      "terminate",
                      "requestCancel",
                      "abandon"
                    ]
                  }
                }
              },
              "params": {
                "type": "object",
                "additionalProperties": true
              }
            }
          },
          "childWorkflow": {
            "type": "object",
            "properties": {
              "id": {
                "type": "string"
              },
              "code": {
                "type": "string"
              },
              "description": {
                "type": "string"
              },
              "step": {
                "type": "string"
              },
              "fn": {
                "type": "string"
              },
              "next": {
                "type": "string"
              },
              "options": {
                "type": "object",
                "properties": {
                  "taskQueue": {
                    "type": "string"
                  },
                  "workflowExecutionTimeout": {
                    "type": "integer",
                    "format": "int64"
                  },
                  "workflowRunTimeout": {
                    "type": "integer",
                    "format": "int64"
                  },
                  "workflowTaskTimeout": {
                    "type": "integer",
                    "format": "int64"
                  },
                  "waitForCancellation": {
                    "type": "boolean"
                  },
                  "parentClosePolicy": {
                    "type": "string",
                    "enum": [
                      "terminate",
                      "requestCancel",
                      "abandon"
                    ]
                  },
                  "memo": {
                    "type": "object",
                    "additionalProperties": true
                  },
                  "searchAttributes": {
                    "type": "object",
                    "additionalProperties": true
                  },
                  "retryPolicy": {
                    "type": "object",
                    "properties": {
                      "initialInterval": {
                        "type": "integer",
                        "format": "int64"
                      },
                      "backoffCoefficient": {
                        "type": "number",
                        "format": "double"
                      },
                      "maximumInterval": {
                        "type": "integer",
                        "format": "int64"
                      },
                      "maximumAttempts": {
                        "type": "integer",
                        "format": "int64"
                      },
                      "nonRetryableErrorReasons": {
                        "type": "array",
                        "items": {
                          "type": "string"
                        }
                      }
                    }
                  }
                }
              },
              "params": {
                "type": "object",
                "additionalProperties": true
              }
            }
          },
          "gateway": {
            "type": "object",
            "properties": {
              "id": {
                "type": "string"
              },
              "code": {
                "type": "string"
              },
              "description": {
                "type": "string"
              },
              "mode": {
                "type": "string",
                "enum": [
                  "split",
                  "join",
                  "single",
                  "multi"
                ]
              },
              "next": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "id": {
                      "type": "string"
                    },
                    "name": {
                      "type": "string"
                    },
                    "variable": {
                      "type": "string"
                    },
                    "operator": {
                      "type": "string"
                    },
                    "operand": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          },
          "start": {
            "type": "object",
            "properties": {
              "id": {
                "type": "string"
              },
              "code": {
                "type": "string"
              },
              "description": {
                "type": "string"
              },
              "next": {
                "type": "string"
              },
              "params": {
                "type": "object",
                "additionalProperties": true
              }
            }
          },
          "finish": {
            "type": "object",
            "properties": {
              "id": {
                "type": "string"
              },
              "code": {
                "type": "string"
              },
              "description": {
                "type": "string"
              },
              "params": {
                "type": "object",
                "additionalProperties": true
              }
            }
          }
        }
      }
    }
  }
}
