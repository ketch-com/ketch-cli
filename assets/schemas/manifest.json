{
  "$schema": "http://json-schema.org/draft-07/schema",
  "type": "object",
  "title": "Marketplace app schema",
  "required": [
    "name",
    "code"
  ],
  "dependencies": {
    "requestUserAuth": ["user_auth_callback_url"]
  },
  "additionalProperties": false,
  "properties": {
    "code": {
      "type": "string",
      "title": "App Code",
      "default": ""
    },
    "org": {
      "type": "string",
      "title": "Organization",
      "default": ""
    },
    "name": {
      "type": "string",
      "title": "App name"
    },
    "version": {
      "type": "string",
      "title": "App semantic version",
      "pattern": "^([0-9]{1,6})\\.([0-9]{1,6})\\.([0-9]{1,6})$"
    },
    "autoUpgrade": {
      "type": "boolean",
      "title": "set to true for instances to be automatically upgraded when new versions are published and approved"
    },
    "depends": {
      "type": "string",
      "title": "comma-separated list of dependency requirements, $package ($version)"
    },
    "provides": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "title": "array of SKU's provided by this manifest"
    },
    "type": {
      "type": "string",
      "enum": [
        "system",
        "internal",
        "custom"
      ],
      "default": "custom",
      "title": "type of the package"
    },
    "instances": {
      "type": "string",
      "enum": [
        "multiple",
        "single"
      ],
      "default": "multiple",
      "title": "number of instances allowed"
    },
    "primaryCategory": {
      "type": ["string", "null"],
      "title": "Marketplace App primary category",
      "enum": [
        "privacy",
        "asset"
      ]
    },
    "secondaryCategory": {
      "type": ["string", "null"],
      "title": "Marketplace App secondary category",
      "enum": [
        "privacy",
        "asset"
      ]
    },
    "rules": {
      "type": ["object", "null"],
      "title": "App rules",
      "additionalProperties": false,
      "properties": {
        "view": {
          "type": "string",
          "title": "rule expressing when the app is visible",
          "default": ""
        },
        "install": {
          "type": "string",
          "title": "rule expression when the app can be installed",
          "default": ""
        }
      }
    },
    "capabilities": {
      "type": "array",
      "title": "App capabilities",
      "items": {
        "type": "string",
        "title": "App capability",
        "enum": [
          "permitPropagation",
          "permitIngestion",
          "rightPropagation",
          "rightIngestion",
          "tagOrchestration"
        ]
      }
    },
    "supportedLanguages": {
      "type": ["array", "null"],
      "title": "App supported languages",
      "items": {
        "type": "string",
        "enum": [
          "en"
        ]
      }
    },
    "supportedPurposes": {
      "type": ["array", "null"],
      "title": "App purposes",
      "items": {
        "type": "string",
        "enum": [
          "essential_services",
          "prod_enhancement",
          "analytics",
          "behavioral_advertising",
          "personalization",
          "tele_mktg",
          "sms_mktg",
          "email_mktg",
          "mail_mktg",
          "data_broking"
        ]
      }
    },
    "supportedRights": {
      "type": ["array", "null"],
      "title": "App rights",
      "items": {
        "type": "string",
        "enum": [
          "delete",
          "access",
          "correction",
          "portability"
        ]
      }
    },
    "shortDescription": {
      "type": "string",
      "title": "short description that appears in search results and galleries",
      "default": ""
    },
    "detailedDescription": {
      "type": "string",
      "title": "detailed description that appears on the app details screen",
      "default": ""
    },
    "permissions": {
      "type": ["array", "null"],
      "title": "App permissions",
      "items": {
        "type": "string",
        "title": "Permission"
      }
    },
    "infoURL": {
      "type": "string",
      "title": "App info URL"
    },
    "setupURL": {
      "type": "string",
      "title": "App setup URL"
    },
    "homepageURL": {
      "type": "string",
      "title": "App homepage URL"
    },
    "customerSupportURL": {
      "type": "string",
      "title": "App customer support URL"
    },
    "privacyPolicyURL": {
      "type": "string",
      "title": "App privacy policy URL"
    },
    "statusURL": {
      "type": "string",
      "title": "App status URL"
    },
    "tosURL": {
      "type": "string",
      "title": "App terms of service URL"
    },
    "docURL": {
      "type": "string",
      "title": "App documentation URL"
    },
    "logo": {
      "type": ["object", "null"],
      "title": "Marketplace App logo",
      "required": [
        "link"
      ],
      "additionalProperties": false,
      "dependentRequired": {
        "width": ["height"],
        "height": ["width"]
      },
      "properties": {
        "title": {
          "type": "string",
          "title": "logo title",
          "default": ""
        },
        "link": {
          "type": "string",
          "title": "filename"
        },
        "width": {
          "type": "integer",
          "title": "logo width",
          "default": 0
        },
        "height": {
          "type": "integer",
          "title": "logo height",
          "default": 0
        }
      }
    },
    "previews": {
      "type": ["array", "null"],
      "title": "Marketplace App previews",
      "items": {
        "type": "object",
        "title": "Image",
        "required": [
          "link"
        ],
        "additionalProperties": false,
        "dependentRequired": {
          "width": ["height"],
          "height": ["width"]
        },
        "properties": {
          "title": {
            "type": "string",
            "title": "Image title",
            "default": ""
          },
          "link": {
            "type": "string",
            "title": "Image filename"
          },
          "width": {
            "type": "integer",
            "title": "Image width",
            "default": 0
          },
          "height": {
            "type": "integer",
            "title": "Image height",
            "default": 0
          }
        }
      }
    },
    "contacts": {
      "type": ["array", "null"],
      "title": "App contacts",
      "items": {
        "type": "object",
        "required": [
          "type",
          "email"
        ],
        "additionalProperties": false,
        "properties": {
          "type": {
            "type": "string",
            "title": "App contact type",
            "enum": [
              "technical",
              "marketing",
              "finance",
              "security"
            ]
          },
          "email": {
            "type": "string",
            "title": "App contact email",
            "format": "email"
          }
        }
      }
    },
    "expireUserTokens": {
      "type": "boolean",
      "title": "Expire user tokens",
      "default": false
    },
    "refreshInterval": {
      "type": "string",
      "title": "App refresh interval",
      "pattern": "([1-9][0-9]*)h",
      "default": ""
    },
    "requestUserAuth": {
      "type": "boolean",
      "title": "Request user auth",
      "default": false
    },
    "userAuthCallbackURL": {
      "type": "string",
      "format": "uri",
      "title": "App OAuth callback URL",
      "default": ""
    },
    "redirectOnUpdate": {
      "type": "boolean",
      "title": "Redirect on update",
      "default": false
    },
    "tagPlugin": {
      "type": "string",
      "title": "Path to local JavaScript file containing front-end plugin code",
      "default": "plugin/plugin.js"
    },
    "assetsDir": {
      "type": "string",
      "title": "Path to local directory containing assets",
      "default": "assets"
    },
    "customObjectsDir": {
      "type": "string",
      "title": "Path to local custom object definitions",
      "default": "objects"
    },
    "webhook": {
      "type": ["object", "null"],
      "title": "App webhook",
      "required": [
        "url",
        "events"
      ],
      "additionalProperties": false,
      "properties": {
        "url": {
          "type": "string",
          "format": "uri",
          "title": "Webhook URI"
        },
        "secret": {
          "type": "string",
          "title": "Base64-encoded webhook secret used to sign events",
          "contentEncoding": "base64",
          "default": ""
        },
        "authorization": {
          "type": "string",
          "title": "Webhook authorization header used to authenticate to the webhook",
          "default": ""
        },
        "events": {
          "type": ["array", "null"],
          "title": "Webhook events",
          "items": {
            "type": "string",
            "enum": [
              "ping",
              "rightInvocation.created",
              "rightInvocation.fulfilled",
              "app.installed",
              "app.refresh",
              "app.uninstalled",
              "consent.propagated",
              "tag.activate",
              "tag.deactivate",
              "tag.requestList"
            ]
          }
        },
        "maxQPS": {
          "type": "integer",
          "format": "int32",
          "default": 100
        },
        "tls": {
          "type": ["object", "null"],
          "title": "TLS configuration",
          "properties": {
            "insecure": {
              "type": "boolean"
            }
          }
        }
      }
    },
    "form": {
      "type": ["array", "null"],
      "items": {
        "type": "object",
        "required": [
          "name",
          "type"
        ],
        "additionalProperties": false,
        "properties": {
          "name": {
            "type": "string",
            "description": "The key field is where the data will be saved to. This must be unique per field.\n For example, if key = 'customers' then the value of the field will be saved in data.customers"
          },
          "title": {
            "type": "string",
            "description": "The name or title for this component"
          },
          "type": {
            "type": "string",
            "description": "The type property will be used to select which component to render on the frontend. It cannot be an existing field type",
            "enum": [
              "array",
              "string"
            ]
          },
          "showOnView": {
            "type": "boolean",
            "description": "If true, the field will appear on the connection overview",
            "default": false
          },
          "showValueOnEdit": {
            "type": "boolean",
            "description": "If false, the field value will not be shown on the edit screen",
            "default": true
          },
          "editable": {
            "type": "boolean",
            "description": "If false, the field cannot be changed",
            "default": true
          },
          "required": {
            "type": "boolean",
            "description": "If true, the field will be required to have a value"
          },
          "minLength": {
            "type": "integer",
            "format": "int64",
            "default": 0
          },
          "maxLength": {
            "type": "integer",
            "format": "int64",
            "default": 0
          },
          "pattern": {
            "type": "string",
            "default": ""
          },
          "placeholder": {
            "type": "string",
            "description": "The placeholder text that will appear when this field is empty",
            "default": ""
          },
          "default": {
            "type": ["string", "null"],
            "description": "Default value will be the value for this field, before user interaction. Having a default value will override the placeholder text"
          },
          "spellcheck": {
            "type": "boolean",
            "description": "This setting will enable spell check on the field.",
            "default": true
          },
          "multiple": {
            "type": "boolean",
            "description": "If true, multiple values can be added in this field.\n The values will appear as an array in the API and an “Add Another” button will be visible on the field allowing the creation of additional fields for this component",
            "default": false
          },
          "data": {
            "type": "object",
            "properties": {
              "oneOf": {
                "values": {
                  "type": ["array", "null"],
                  "description": "These are the values that will be selected on this field",
                  "items": {
                    "type": "object",
                    "required": [
                      "label",
                      "value"
                    ],
                    "additionalProperties": false,
                    "properties": {
                      "value": {
                        "type": "string"
                      },
                      "label": {
                        "type": "string"
                      }
                    }
                  }
                },
                "json": {
                  "type": "string",
                  "description": "Enter a JSON Array to use. It should be formatted as an array of objects with named properties",
                  "default": ""
                },
                "url": {
                  "type": "string",
                  "description": "Enter a url with a data source in JSON Array format. This can be used to populate a Select list with external JSON values",
                  "format": "uri",
                  "default": ""
                }
              }
            }
          }
        }
      }
    },
    "identitySpaces": {
      "type": ["array", "null"],
      "title": "App identity spaces",
      "items": {
        "type": "object",
        "title": "App identity space",
        "oneOf": [
          {
            "required": [
              "code",
              "name",
              "filters"
            ],
            "properties": {
              "managed": {
                "type": "boolean",
                "title": "Whether this identity space is managed or mapped",
                "pattern": "false"
              },
              "code": {
                "type": "string",
                "title": "App identity space code"
              },
              "name": {
                "type": "string",
                "title": "App identity space name"
              },
              "description": {
                "type": "string",
                "title": "App identity space description",
                "default": ""
              },
              "filters": {
                "type": "array",
                "title": "App identity space filters",
                "items": {
                  "type": "object",
                  "title": "A filter",
                  "required": [
                    "type",
                    "format"
                  ],
                  "additionalProperties": false,
                  "properties": {
                    "type": {
                      "type": "string",
                      "title": "App identity space filter type",
                      "enum": [
                        "email",
                        "controller_customer_id",
                        "android_advertising_id",
                        "android_id",
                        "fire_advertising_id",
                        "ios_advertising_id",
                        "ios_vendor_id",
                        "microsoft_advertising_id",
                        "microsoft_publisher_id",
                        "roku_publisher_id",
                        "roku_advertising_id",
                        "unique_browser",
                        "telephone"
                      ]
                    },
                    "format": {
                      "type": "string",
                      "title": "App identity space filter format",
                      "enum": [
                        "raw",
                        "SHA1",
                        "SHA256",
                        "SHA512"
                      ]
                    }
                  }
                }
              }
            }
          },
          {
            "required": [
              "code",
              "name",
              "type",
              "variable"
            ],
            "properties": {
              "managed": {
                "type": "boolean",
                "title": "Whether this identity space is managed or mapped",
                "pattern": "true"
              },
              "code": {
                "type": "string",
                "title": "App identity space code"
              },
              "name": {
                "type": "string",
                "title": "App identity space name"
              },
              "description": {
                "type": "string",
                "title": "App identity space description",
                "default": ""
              },
              "type": {
                "type": "string",
                "title": "App identity space filter type",
                "enum": [
                  "email",
                  "controller_customer_id",
                  "android_advertising_id",
                  "android_id",
                  "fire_advertising_id",
                  "ios_advertising_id",
                  "ios_vendor_id",
                  "microsoft_advertising_id",
                  "microsoft_publisher_id",
                  "roku_publisher_id",
                  "roku_advertising_id",
                  "unique_browser",
                  "telephone"
                ]
              },
              "format": {
                "type": "string",
                "title": "App identity space filter format",
                "default": "raw",
                "enum": [
                  "raw",
                  "sha1",
                  "sha256",
                  "sha512"
                ]
              },
              "variable": {
                "type": "object",
                "title": "Variable definition",
                "required": [
                  "location",
                  "name"
                ],
                "additionalProperties": false,
                "properties": {
                  "name": {
                    "type": "string",
                    "title": "Name of the variable"
                  },
                  "location": {
                    "type": "string",
                    "title": "Location of the variable",
                    "enum": [
                      "window",
                      "cookie",
                      "dataLayer"
                    ]
                  },
                  "jwt": {
                    "type": ["object", "null"],
                    "title": "JWT details",
                    "required": [
                      "location",
                      "key"
                    ],
                    "additionalProperties": false,
                    "properties": {
                      "location": {
                        "type": "string",
                        "title": "location to find the variable within the JWT",
                        "enum": [
                          "header",
                          "claims"
                        ]
                      },
                      "key": {
                        "type": "string",
                        "title": "key of the variable within the JWT"
                      }
                    }
                  }
                }
              }
            }
          }
        ]
      }
    }
  }
}
